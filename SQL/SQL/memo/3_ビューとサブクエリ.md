# ビュー
## 基礎
- SELECT文をテーブルとして保存したもの
- その為テーブル同様、select文でレコードを取得したり、ビューからビューを作る事も可能

## 文法
### 作成
- CREATE VIEW view_name (列名) AS select文
- 定義時にORDER BYが使用出来ない(MySQLは使用可能)
  - ビューの行には順序がないと定められている
```sql
CREATE VIEW view_name (genre, record_count) AS
  SELECT genre, COUNT(*) FROM table_or_view GROUP BY genre;
``` 
### 作成後
- ビューに対してCUDは行えない
- しかし、以下の条件を満たしている場合にビューにCUDを行うと、元のテーブルを更新できる
  - SELECTに対してのDISTINCTを使用していない
  - GROUP BY, HAVINGを使用していない
  - 対象のテーブルが単体

# サブクエリ
## サブクエリとは
- SELECT文の対象には、ビューから情報を取得するのと同じようにSELECT文を指定できる
- SELECT文をネストさせた時の、子要素の事をサブクエリという
- SELECT ~ FROM ( SELECT文 ) AS サブクエリ名
- サブクエリ名に特に決まり等はない
```sql
SELECT genre, count_item
  FROM /*ここからサブクエリ*/(SELECT id, genre, count(*) AS count_item
    FROM table_name GROUP BY genre) AS genres/*サブクエリ名*/;
```

## スカラ・サブクエリ
- サブクエリの一つ
- 単一のデータ(1行1列)のデータを返すサブクエリ
- クエリ自体が戻り値のように、処理結果の値(取り出した単一のデータ)として振舞う
- SELECT文ならどこでも使用可能
- サブクエリ名を付けない
```sql
SELECT * FROM table_name
  WHERE cost > (SELECT AVG(cost) FROM table_name)/*cost > tableの平均cost*/;
```

## 相関サブクエリ
- サブクエリの一つ
- 親クエリが参照しているレコードの情報を、サブクエリで参照できる
  - よって、親クエリのWHERE句で、同じジャンルの列1の値と、レコードの列1の平均値を比べる等の事が出来る
- `相関名:` 親クエリとサブクエリの参照テーブルに別名を付ける事で、参照先を分ける
- 相関名にも、他のプログラム言語のようにスコープがあり、サブクエリで付けた相関名は、親クエリでは使えない
```sql
/*親クエリ*/
SELECT * FROM table_name AS t1 
  WHERE selling_price < (  
    /*サブクエリ*/
    SELECT AVG(selling_price) FROM table_name AS t2
      WHERE t1.genre = t2.genre/*親クエリと同じジャンルのレコードを抽出して、AVG関数を実行する*/
  )
;
```
